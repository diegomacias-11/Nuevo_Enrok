{% extends "lista.html" %}

{% block title %}Citas{% endblock %}

{% block extra_head %}
  <style>
    /* Barra de filtros estilo dispersiones: etiquetas arriba, inputs abajo, separadores y botones alineados */
    .filter-container {
      display: flex !important;
      align-items: center !important;
      gap: 1rem !important;
      flex-wrap: wrap !important;
    }
    .citas-filter {
      display: flex !important;
      align-items: flex-end !important;
      gap: 0.75rem !important;
      flex: 1 1 auto !important;
      justify-content: center !important;
      flex-wrap: wrap !important;
    }
    .citas-filter .filter-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: .2rem;
    }
    .citas-filter .filter-group label {
      color: #ffffff;
      font-weight: 700;
      font-size: 0.9rem;
      margin: 0;
      padding: 0;
    }
    .citas-filter .filter-group input[type="date"],
    .citas-filter .filter-group select {
      padding: .32rem .45rem;
      border-radius: 6px;
    }
    .citas-filter #fecha_desde,
    .citas-filter #fecha_hasta {
      min-width: 8rem !important;
      width: 8rem !important;
      max-width: 8rem !important;
    }
    .citas-filter #estatus_seguimiento {
      min-width: 12rem !important;
    }
    .citas-filter .sep {
      width: 1px;
      height: 2.8rem;
      background: #ffcf56;
      align-self: flex-end;
      display: inline-block;
    }
    .citas-filter .btn-filter {
      margin: 0;
      align-self: center;
    }
    .citas-filter .btn-filtrar,
    .citas-filter .btn-limpiar {
      align-self: flex-end;
    }
    /* Botón principal a la derecha */
    .filter-container > .btn-primary {
      margin-left: auto !important;
      position: static !important;
      transform: none !important;
    }
    @media (max-width: 900px) {
      .citas-filter {
        justify-content: center !important;
      }
    }
  </style>
{% endblock %}

{% block filtros %}
  <form method="get" class="filter-form-simple citas-filter">
    <div class="filter-group">
      <label for="fecha_desde">Fecha desde</label>
      <input type="date" id="fecha_desde" name="fecha_desde" value="{{ fecha_desde }}" />
    </div>
    <span class="sep" aria-hidden="true"></span>
    <div class="filter-group">
      <label for="fecha_hasta">Fecha hasta</label>
      <input type="date" id="fecha_hasta" name="fecha_hasta" value="{{ fecha_hasta }}" />
    </div>
    <span class="sep" aria-hidden="true"></span>
    <div class="filter-group">
      <label for="estatus_seguimiento">Estatus seguimiento</label>
      <select id="estatus_seguimiento" name="estatus_seguimiento">
        <option value="">Todos</option>
        {% for value, label in estatus_seguimiento_choices %}
          <option value="{{ value }}" {% if value == estatus_seguimiento %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>
    <button type="submit" class="btn-filter btn-filtrar">Filtrar</button>
    <a href="{% url 'citas_lista' %}" class="btn-filter btn-limpiar">Limpiar</a>
  </form>
  <a href="{% url 'agregar_cita' %}?next={{ request.get_full_path|urlencode }}" class="btn-primary">Nueva cita</a>
{% endblock %}

{% block tabla_head %}
  <tr>
    <th class="sticky-1 col-actions">Acciones</th>
    <th>Prospecto</th>
    <th>Medio</th>
    <th>Servicio</th>
    <th>Vendedor</th>
    <th>Estatus cita</th>
    <th>Posbilidad de cierre</th>
    <th>Fecha cita</th>
    <th>Número cita</th>
    <th>Estatus seguimiento</th>
    <th>Lugar</th>
  </tr>
{% endblock %}

{% block tabla_body %}
  {% for c in citas %}
    <tr>
      <td class="sticky-1 col-actions">
        <a href="{% url 'editar_cita' c.id %}?next={{ request.get_full_path|urlencode }}" class="btn-detalle">Detalle</a>
      </td>
      <td>{{ c.prospecto|default_if_none:"" }}</td>
      <td>{{ c.medio|default_if_none:"" }}</td>
      <td>{{ c.servicio|default_if_none:"" }}</td>
      <td>{{ c.vendedor|default_if_none:"" }}</td>
      <td>{{ c.estatus_cita|default_if_none:"" }}</td>
      <td>{{ c.posibilidad|default_if_none:"" }}</td>
      <td>{{ c.fecha_cita|date:"l d/M/y H:i"|default_if_none:"" }}</td>
      <td>{{ c.numero_cita|default_if_none:"" }}</td>
      <td>{{ c.estatus_seguimiento|default_if_none:"" }}</td>
      <td>{{ c.lugar|default_if_none:"" }}</td>
    </tr>
  {% empty %}
    <tr>
      <td colspan="100%">Sin citas registradas</td>
    </tr>
  {% endfor %}
{% endblock %}
